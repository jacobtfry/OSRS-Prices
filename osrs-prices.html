<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-store" /> <!-- Disable caching -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSRS Prices</title>
    <script src="./tailwind.css"></script>
    <style>
        /* Styles for sort indicators */
        .sort-indicator {
            display: inline-block;
            margin-left: 5px;
            cursor: pointer;
        }
    </style>
</head>

<body class="bg-gray-100 p-8">
    <h1 class="text-3xl font-bold mb-6">OSRS Prices</h1>

    <!-- Search Input and Filter Button -->
    <div class="mb-6 flex items-center justify-between">
        <input type="text" id="search-input" placeholder="Search items..."
            class="px-4 py-2 border rounded flex-grow mr-4">

        <!-- Dropdown for preset values -->
        <select id="preset-dropdown" class="px-4 py-2 bg-white border rounded mr-4">
            <option value="">Select Preset</option>
            <option value="hotVolume">Hot Volume</option>
        </select>

        <!-- Show/Hide Filters Button -->
        <button id="filter-button" class="px-4 py-2 bg-blue-500 text-white rounded w-40 mr-4">Show Filters</button>

        <!-- Reset Filters Button outside the filter div with added margin -->
        <button id="reset-filters-outside" class="px-4 py-2 bg-red-500 text-white rounded">Reset Filters</button>
    </div>

    <!-- Filter Panel -->
    <div id="filter-panel" class="mb-6 p-4 bg-gray-200 rounded-lg" style="display: none;">
        <h2 class="text-xl font-bold mb-4">Filter Columns</h2>
        <div class="grid grid-cols-2 gap-4">
            <!-- Filters for each column -->
            <div>
                <label for="minInstabuy" class="block mb-2">Min Instabuy Price:</label>
                <input type="text" id="minInstabuy" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="maxInstabuy" class="block mb-2">Max Instabuy Price:</label>
                <input type="text" id="maxInstabuy" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="minInstasell" class="block mb-2">Min Instasell Price:</label>
                <input type="text" id="minInstasell" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="maxInstasell" class="block mb-2">Max Instasell Price:</label>
                <input type="text" id="maxInstasell" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="minMargin" class="block mb-2">Min Margin:</label>
                <input type="text" id="minMargin" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="maxMargin" class="block mb-2">Max Margin:</label>
                <input type="text" id="maxMargin" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="minProfit" class="block mb-2">Min Potential Profit:</label>
                <input type="text" id="minProfit" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="maxProfit" class="block mb-2">Max Potential Profit:</label>
                <input type="text" id="maxProfit" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="minMarginVolume" class="block mb-2">Min Margin X Volume:</label>
                <input type="text" id="minMarginVolume" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="maxMarginVolume" class="block mb-2">Max Margin X Volume:</label>
                <input type="text" id="maxMarginVolume" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="minVolume" class="block mb-2">Min Volume:</label>
                <input type="text" id="minVolume" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="maxVolume" class="block mb-2">Max Volume:</label>
                <input type="text" id="maxVolume" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="minLimit" class="block mb-2">Min Limit:</label>
                <input type="text" id="minLimit" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="maxLimit" class="block mb-2">Max Limit:</label>
                <input type="text" id="maxLimit" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="minHighTime" class="block mb-2">Min Latest Instabuy (minutes):</label>
                <input type="text" id="minHighTime" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="maxHighTime" class="block mb-2">Max Latest Instabuy (minutes):</label>
                <input type="text" id="maxHighTime" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="minLowTime" class="block mb-2">Min Latest Instasell (minutes):</label>
                <input type="text" id="minLowTime" class="px-4 py-2 border rounded w-full number-input">
            </div>
            <div>
                <label for="maxLowTime" class="block mb-2">Max Latest Instasell (minutes):</label>
                <input type="text" id="maxLowTime" class="px-4 py-2 border rounded w-full number-input">
            </div>
        </div>

        <div class="mt-4 flex space-x-4">
            <button id="apply-filters" class="px-4 py-2 bg-green-500 text-white rounded">Apply Filters</button>
            <button id="reset-filters" class="px-4 py-2 bg-red-500 text-white rounded">Reset Filters</button>
            <button id="close-filters" class="px-4 py-2 bg-blue-500 text-white rounded">Hide Filters</button>
        </div>
    </div>

    <div id="item-list">
        <table class="min-w-full table-auto bg-white shadow-md rounded-lg">
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold"></th>
                    <!-- Updated headers to be clickable -->
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer" data-column="itemName">Item
                        Name<span class="sort-indicator" id="sort-itemName"><svg width="14" height="14"
                                viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"
                                class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon">
                                <path
                                    d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.2426 14 9.93552 13.6929 9.93552 13.3226V0.677419C9.93552 0.307097 10.2426 0 10.6129 0C10.9833 0 11.2904 0.307097 11.2904 0.677419V13.3226C11.2904 13.6929 10.9832 14 10.6129 14Z"
                                    fill="currentColor"></path>
                            </svg></span></th>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer" data-column="instabuyPrice">
                        Instabuy<span class="sort-indicator" id="sort-instabuyPrice"><svg width="14" height="14"
                                viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"
                                class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon">
                                <path
                                    d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z"
                                    fill="currentColor"></path>
                            </svg></span></th>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer" data-column="instasellPrice">
                        Instasell<span class="sort-indicator" id="sort-instasellPrice"><svg width="14" height="14"
                                viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"
                                class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon">
                                <path
                                    d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z"
                                    fill="currentColor"></path>
                            </svg></span></th>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer" data-column="highTime">Latest
                        Instabuy<span class="sort-indicator" id="sort-highTime"><svg width="14" height="14"
                                viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"
                                class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon">
                                <path
                                    d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z"
                                    fill="currentColor"></path>
                            </svg></span></th>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer" data-column="lowTime">Latest
                        Instasell<span class="sort-indicator" id="sort-lowTime"><svg width="14" height="14"
                                viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"
                                class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon">
                                <path
                                    d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.2426 14 9.93552 13.6929 9.93552 13.3226V0.677419C9.93552 0.307097 10.2426 0 10.6129 0C10.9833 0 11.2904 0.307097 11.2904 0.677419V13.3226C11.2904 13.6929 10.9832 14 10.6129 14Z"
                                    fill="currentColor"></path>
                            </svg></span></th>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer" data-column="margin">
                        Margin<span class="sort-indicator" id="sort-margin"><svg width="14" height="14"
                                viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"
                                class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon">
                                <path
                                    d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.2426 14 9.93552 13.6929 9.93552 13.3226V0.677419C9.93552 0.307097 10.2426 0 10.6129 0C10.9833 0 11.2904 0.307097 11.2904 0.677419V13.3226C11.2904 13.6929 10.9832 14 10.6129 14Z"
                                    fill="currentColor"></path>
                            </svg></span></th>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer"
                        data-column="potentialProfit">Potential Profit<span class="sort-indicator"
                            id="sort-potentialProfit"></span></th>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer" data-column="marginVolume">
                        Margin X Volume<span class="sort-indicator" id="sort-marginVolume"><svg width="14" height="14"
                                viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"
                                class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon">
                                <path
                                    d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.2426 14 9.93552 13.6929 9.93552 13.3226V0.677419C9.93552 0.307097 10.2426 0 10.6129 0C10.9833 0 11.2904 0.307097 11.2904 0.677419V13.3226C11.2904 13.6929 10.9832 14 10.6129 14Z"
                                    fill="currentColor"></path>
                            </svg></span></th>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer" data-column="totalVolume">
                        Volume<span class="sort-indicator" id="sort-totalVolume"><svg width="14" height="14"
                                viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"
                                class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon">
                                <path
                                    d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.2426 14 9.93552 13.6929 9.93552 13.3226V0.677419C9.93552 0.307097 10.2426 0 10.6129 0C10.9833 0 11.2904 0.307097 11.2904 0.677419V13.3226C11.2904 13.6929 10.9832 14 10.6129 14Z"
                                    fill="currentColor"></path>
                            </svg></span></th>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer" data-column="limit">
                        Limit<span class="sort-indicator" id="sort-limit"><svg width="14" height="14"
                                viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"
                                class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon">
                                <path
                                    d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.2426 14 9.93552 13.6929 9.93552 13.3226V0.677419C9.93552 0.307097 10.2426 0 10.6129 0C10.9833 0 11.2904 0.307097 11.2904 0.677419V13.3226C11.2904 13.6929 10.9832 14 10.6129 14Z"
                                    fill="currentColor"></path>
                            </svg></span></th>
                    <th class="px-4 py-2 text-left text-gray-600 font-bold cursor-pointer" data-column="highAlchValue">
                        HA<span class="sort-indicator" id="sort-limit"><svg width="14" height="14" viewBox="0 0 14 14"
                                fill="none" xmlns="http://www.w3.org/2000/svg" class="p-icon p-sortable-column-icon"
                                aria-hidden="true" data-pc-section="sorticon">
                                <path
                                    d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z"
                                    fill="currentColor"></path>
                                <path
                                    d="M10.6129 14C10.2426 14 9.93552 13.6929 9.93552 13.3226V0.677419C9.93552 0.307097 10.2426 0 10.6129 0C10.9833 0 11.2904 0.307097 11.2904 0.677419V13.3226C11.2904 13.6929 10.9832 14 10.6129 14Z"
                                    fill="currentColor"></path>
                            </svg></span></th>
                </tr>
            </thead>
            <tbody id="item-list-body" class="divide-y divide-gray-200">
                <!-- List view will populate here -->
            </tbody>
        </table>
    </div>

    <script>
        let itemMapping = {};
        let itemDetails = {};
        let itemDataArray = [];
        let currentSortColumn = 'margin';
        let currentSortDirection = 'desc';
        const requestHeaders = {
            'User-Agent': 'Flipping_Tracker',
        };

        // Fetch the item name to ID mapping
        async function fetchItemNames() {
            const apiUrl = 'https://oldschool.runescape.wiki/?title=Module:GEIDs/data.json&action=raw&ctype=application%2Fjson';
            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: requestHeaders
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch item mapping');
                }
                itemMapping = await response.json();
            } catch (error) {
                console.error('Error fetching item mapping:', error);
            }
        }

        // Fetch item metadata (icon, alch values, etc.)
        async function fetchItemDetails() {
            const apiUrl = 'https://prices.runescape.wiki/api/v1/osrs/mapping';
            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: requestHeaders
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch item details');
                }
                itemDetails = await response.json();
            } catch (error) {
                console.error('Error fetching item details:', error);
            }
        }

        // Function to format numbers with K, M, B suffixes
        function roundedFormat(number) {
            if (number === undefined || number === null) return 'N/A';

            const absNumber = Math.abs(number); // Get absolute value to handle formatting

            let formattedNumber;
            if (absNumber >= 1e9) {
                formattedNumber = (number / 1e9).toFixed(2); // Billions
            } else if (absNumber >= 1e6) {
                formattedNumber = (number / 1e6).toFixed(2); // Millions
            } else if (absNumber >= 1e3) {
                formattedNumber = (number / 1e3).toFixed(2); // Thousands
            } else {
                formattedNumber = number.toLocaleString(); // For smaller numbers, just use commas
            }

            // Remove trailing zeros from formatted values (convert to number and back to string)
            if (typeof formattedNumber === 'string') {
                formattedNumber = parseFloat(formattedNumber).toString();
            }

            // Add suffix (K, M, B) if applicable
            if (absNumber >= 1e9) {
                return formattedNumber + 'B'; // Billions
            } else if (absNumber >= 1e6) {
                return formattedNumber + 'M'; // Millions
            } else if (absNumber >= 1e3) {
                return formattedNumber + 'K'; // Thousands
            } else {
                return formattedNumber; // For smaller numbers, no suffix
            }
        }

        // Function to format number with commas
        function formatNumberWithCommas(number) {
            if (!number) return '';
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // Function to strip commas from a formatted number
        function stripCommas(numberString) {
            return numberString.replace(/,/g, '');
        }

        // Add event listeners for formatted inputs and restrict to numbers
        function setupFormattedNumberInput(inputId) {
            const inputElement = document.getElementById(inputId);

            inputElement.addEventListener('input', () => {
                let value = inputElement.value.replace(/[^0-9]/g, ''); // Allow only numbers

                value = stripCommas(value);
                if (!isNaN(value) && value !== '') {
                    inputElement.value = formatNumberWithCommas(value);
                }
            });

            inputElement.addEventListener('blur', () => {
                if (inputElement.value === '') {
                    inputElement.value = '';
                }
            });
        }

        // Set up formatted number inputs and restrict to numbers
        function setupNumberFormatting() {
            const inputIds = [
                'minInstabuy', 'maxInstabuy', 'minInstasell', 'maxInstasell',
                'minMargin', 'maxMargin', 'minProfit', 'maxProfit',
                'minMarginVolume', 'maxMarginVolume', 'minVolume', 'maxVolume',
                'minLimit', 'maxLimit', 'minHighTime', 'maxHighTime', 'minLowTime', 'maxLowTime'
            ];

            inputIds.forEach(id => setupFormattedNumberInput(id));
        }

        // Convert timestamp to a human-readable time format
        function getTimeDifference(timestamp) {
            const now = Math.floor(Date.now() / 1000); // Get current time in seconds
            const secondsAgo = now - timestamp; // Calculate time difference

            // Time constants
            const minute = 60;
            const hour = minute * 60;
            const day = hour * 24;
            const week = day * 7;
            const month = day * 30;
            const year = day * 365;

            // Calculate time differences with singular/plural handling
            if (secondsAgo < minute) {
                return `${secondsAgo} second${secondsAgo !== 1 ? 's' : ''} ago`;
            } else if (secondsAgo < hour) {
                const minutesAgo = Math.floor(secondsAgo / minute);
                return `${minutesAgo} minute${minutesAgo !== 1 ? 's' : ''} ago`;
            } else if (secondsAgo < day) {
                const hoursAgo = Math.floor(secondsAgo / hour);
                return `${hoursAgo} hour${hoursAgo !== 1 ? 's' : ''} ago`;
            } else if (secondsAgo < week) {
                const daysAgo = Math.floor(secondsAgo / day);
                return `${daysAgo} day${daysAgo !== 1 ? 's' : ''} ago`;
            } else if (secondsAgo < month) {
                const weeksAgo = Math.floor(secondsAgo / week);
                return `${weeksAgo} week${weeksAgo !== 1 ? 's' : ''} ago`;
            } else if (secondsAgo < year) {
                const monthsAgo = Math.floor(secondsAgo / month);
                return `${monthsAgo} month${monthsAgo !== 1 ? 's' : ''} ago`;
            } else {
                const yearsAgo = Math.floor(secondsAgo / year);
                return `${yearsAgo} year${yearsAgo !== 1 ? 's' : ''} ago`;
            }
        }

        // Convert timestamp to time difference in minutes for filtering
        function getTimeDifferenceInMinutes(timestamp) {
            const now = Math.floor(Date.now() / 1000);
            const secondsAgo = now - timestamp;
            return Math.floor(secondsAgo / 60); // Convert to minutes
        }

        // Function to display items in the table with a maximum of 50 items
        function displayItems(items) {
            const itemListBody = document.getElementById('item-list-body');
            itemListBody.innerHTML = ''; // Clear the table body

            const maxItems = 50; // Maximum number of items to display

            // Sort items if a sort column is selected
            if (currentSortColumn) {
                items.sort((a, b) => {
                    let valueA = a[currentSortColumn];
                    let valueB = b[currentSortColumn];

                    // Handle undefined or null values
                    if (valueA == null) valueA = '';
                    if (valueB == null) valueB = '';

                    // For numeric columns, compare numbers
                    if (typeof valueA === 'number' && typeof valueB === 'number') {
                        return currentSortDirection === 'asc' ? valueA - valueB : valueB - valueA;
                    }

                    // For string columns, compare strings
                    valueA = valueA.toString().toLowerCase();
                    valueB = valueB.toString().toLowerCase();

                    if (valueA < valueB) return currentSortDirection === 'asc' ? -1 : 1;
                    if (valueA > valueB) return currentSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            for (let i = 0; i < items.length && i < maxItems; i++) {
                const item = items[i];
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td class="px-4 py-2"><img src="${item.imageUrl}" alt="${item.itemName}" class="block mx-auto max-w-[48px] max-h-[48px] w-auto h-auto"></td>
                    <td class="px-4 py-2"><a href="https://prices.runescape.wiki/osrs/item/${item.itemId}" target="_blank">${item.itemName}</a></td>
                    <td class="px-4 py-2">${formatNumberWithCommas(item.instabuyPrice)}</td>
                    <td class="px-4 py-2">${formatNumberWithCommas(item.instasellPrice)}</td>
                    <td class="px-4 py-2">${item.highTimeFormatted}</td>
                    <td class="px-4 py-2">${item.lowTimeFormatted}</td>
                    <td class="px-4 py-2" style="color: ${item.margin >= 0 ? 'green' : 'red'};">${roundedFormat(item.margin)}</td>
                    <td class="px-4 py-2" style="color: ${item.potentialProfit >= 0 ? 'green' : 'red'};">${roundedFormat(item.potentialProfit)}</td>
                    <td class="px-4 py-2" style="color: ${item.marginVolume >= 0 ? 'green' : 'red'};">${roundedFormat(item.marginVolume)}</td>
                    <td class="px-4 py-2">${roundedFormat(item.totalVolume)}</td>
                    <td class="px-4 py-2">${formatNumberWithCommas(item.limit)}</td>
                    <td class="px-4 py-2">${formatNumberWithCommas(item.highAlchValue)}</td>
                `;
                itemListBody.appendChild(row);
            }
        }

        // Function to filter items based on the search input and filters
        function filterItems() {
            const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();

            let filteredItems = itemDataArray;

            if (searchTerm) {
                filteredItems = itemDataArray.filter(item => item.itemName.toLowerCase().includes(searchTerm));
            }

            // Apply filter panel values
            const minInstabuy = parseFloat(stripCommas(document.getElementById('minInstabuy').value));
            const maxInstabuy = parseFloat(stripCommas(document.getElementById('maxInstabuy').value));
            const minInstasell = parseFloat(stripCommas(document.getElementById('minInstasell').value));
            const maxInstasell = parseFloat(stripCommas(document.getElementById('maxInstasell').value));
            const minMargin = parseFloat(stripCommas(document.getElementById('minMargin').value));
            const maxMargin = parseFloat(stripCommas(document.getElementById('maxMargin').value));
            const minProfit = parseFloat(stripCommas(document.getElementById('minProfit').value));
            const maxProfit = parseFloat(stripCommas(document.getElementById('maxProfit').value));
            const minMarginVolume = parseFloat(stripCommas(document.getElementById('minMarginVolume').value));
            const maxMarginVolume = parseFloat(stripCommas(document.getElementById('maxMarginVolume').value));
            const minVolume = parseFloat(stripCommas(document.getElementById('minVolume').value));
            const maxVolume = parseFloat(stripCommas(document.getElementById('maxVolume').value));
            const minLimit = parseFloat(stripCommas(document.getElementById('minLimit').value));
            const maxLimit = parseFloat(stripCommas(document.getElementById('maxLimit').value));

            const minHighTime = parseFloat(stripCommas(document.getElementById('minHighTime').value));
            const maxHighTime = parseFloat(stripCommas(document.getElementById('maxHighTime').value));
            const minLowTime = parseFloat(stripCommas(document.getElementById('minLowTime').value));
            const maxLowTime = parseFloat(stripCommas(document.getElementById('maxLowTime').value));

            filteredItems = filteredItems.filter(item => {
                let instabuyCheck = (!isNaN(minInstabuy) ? item.instabuyPrice >= minInstabuy : true) &&
                    (!isNaN(maxInstabuy) ? item.instabuyPrice <= maxInstabuy : true);
                let instasellCheck = (!isNaN(minInstasell) ? item.instasellPrice >= minInstasell : true) &&
                    (!isNaN(maxInstasell) ? item.instasellPrice <= maxInstasell : true);
                let marginCheck = (!isNaN(minMargin) ? item.margin >= minMargin : true) &&
                    (!isNaN(maxMargin) ? item.margin <= maxMargin : true);
                let profitCheck = (!isNaN(minProfit) ? item.potentialProfit >= minProfit : true) &&
                    (!isNaN(maxProfit) ? item.potentialProfit <= maxProfit : true);
                let marginVolumeCheck = (!isNaN(minMarginVolume) ? item.marginVolume >= minMarginVolume : true) &&
                    (!isNaN(maxMarginVolume) ? item.marginVolume <= maxMarginVolume : true);
                let volumeCheck = (!isNaN(minVolume) ? item.totalVolume >= minVolume : true) &&
                    (!isNaN(maxVolume) ? item.totalVolume <= maxVolume : true);
                let limitCheck = (!isNaN(minLimit) ? item.limit >= minLimit : true) &&
                    (!isNaN(maxLimit) ? item.limit <= maxLimit : true);

                let highTimeCheck = (!isNaN(minHighTime) ? getTimeDifferenceInMinutes(item.highTime) >= minHighTime : true) &&
                    (!isNaN(maxHighTime) ? getTimeDifferenceInMinutes(item.highTime) <= maxHighTime : true);
                let lowTimeCheck = (!isNaN(minLowTime) ? getTimeDifferenceInMinutes(item.lowTime) >= minLowTime : true) &&
                    (!isNaN(maxLowTime) ? getTimeDifferenceInMinutes(item.lowTime) <= maxLowTime : true);

                return instabuyCheck && instasellCheck && marginCheck && profitCheck && marginVolumeCheck && volumeCheck && limitCheck && highTimeCheck && lowTimeCheck;
            });

            displayItems(filteredItems);
        }

        // Apply filters when the "Apply Filters" button is clicked
        document.getElementById('apply-filters').addEventListener('click', filterItems);

        // Reset Filters functionality
        document.getElementById('reset-filters').addEventListener('click', () => {
            const inputs = document.querySelectorAll('#filter-panel input');
            inputs.forEach(input => input.value = ''); // Clear all input fields

            // Reset preset dropdown to default
            document.getElementById('preset-dropdown').value = '';

            filterItems(); // Re-apply filters after reset
        });

        // Reset Filters functionality for outside button
        document.getElementById('reset-filters-outside').addEventListener('click', () => {
            const inputs = document.querySelectorAll('#filter-panel input');
            inputs.forEach(input => input.value = ''); // Clear all input fields

            // Reset preset dropdown to default
            document.getElementById('preset-dropdown').value = '';

            filterItems(); // Re-apply filters after reset
        });

        // Close Filters functionality
        document.getElementById('close-filters').addEventListener('click', () => {
            document.getElementById('filter-panel').style.display = 'none';
            document.getElementById('filter-button').textContent = 'Show Filters';
        });

        // Preset dropdown values for loading filter configurations
        document.getElementById('preset-dropdown').addEventListener('change', (event) => {
            const preset = event.target.value;

            // Define preset filter values
            const presets = {
                'hotVolume': {
                    minVolume: '10000',
                    maxInstabuy: '10000000',
                    maxInstasell: '10000000',
                    maxHighTime: '5',
                    maxLowTime: '5'
                }
            };

            // Get the preset values based on the selected option
            const selectedPreset = presets[preset];

            if (selectedPreset) {
                // Apply preset values to the filter inputs
                for (const [key, value] of Object.entries(selectedPreset)) {
                    const inputField = document.getElementById(key);
                    if (inputField) {
                        inputField.value = value;
                    }
                }

                // Apply filters automatically after loading the preset
                filterItems();
            }
        });

        // Toggle filter panel visibility and button text
        document.getElementById('filter-button').addEventListener('click', () => {
            const filterPanel = document.getElementById('filter-panel');
            const filterButton = document.getElementById('filter-button');
            const isPanelVisible = filterPanel.style.display === 'block';

            filterPanel.style.display = isPanelVisible ? 'none' : 'block';
            filterButton.textContent = isPanelVisible ? 'Show Filters' : 'Hide Filters';
        });

        // Function to handle sorting when a header is clicked
        function handleSort(event) {
            const column = event.target.getAttribute('data-column');

            if (!column) return;

            // Determine the new sort direction
            if (currentSortColumn === column) {
                // Toggle between ascending and descending, no neutral state
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                // Switch to a new column with default direction as descending
                currentSortColumn = column;
                currentSortDirection = 'desc';
            }

            // Update sort indicators
            updateSortIndicators();

            // Re-filter and display items
            filterItems();
        }

        // Function to update sort indicators in the headers
        function updateSortIndicators() {
            const headers = document.querySelectorAll('th[data-column]');

            // Define the SVGs for ascending, descending, and neutral
            const neutralIcon = `<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon"><path d="M5.64515 3.61291C5.47353 3.61291 5.30192 3.54968 5.16644 3.4142L3.38708 1.63484L1.60773 3.4142C1.34579 3.67613 0.912244 3.67613 0.650309 3.4142C0.388374 3.15226 0.388374 2.71871 0.650309 2.45678L2.90837 0.198712C3.17031 -0.0632236 3.60386 -0.0632236 3.86579 0.198712L6.12386 2.45678C6.38579 2.71871 6.38579 3.15226 6.12386 3.4142C5.98837 3.54968 5.81676 3.61291 5.64515 3.61291Z" fill="currentColor"></path><path d="M3.38714 14C3.01681 14 2.70972 13.6929 2.70972 13.3226V0.677419C2.70972 0.307097 3.01681 0 3.38714 0C3.75746 0 4.06456 0.307097 4.06456 0.677419V13.3226C4.06456 13.6929 3.75746 14 3.38714 14Z" fill="currentColor"></path><path d="M10.6129 14C10.4413 14 10.2697 13.9368 10.1342 13.8013L7.87611 11.5432C7.61418 11.2813 7.61418 10.8477 7.87611 10.5858C8.13805 10.3239 8.5716 10.3239 8.83353 10.5858L10.6129 12.3652L12.3922 10.5858C12.6542 10.3239 13.0877 10.3239 13.3497 10.5858C13.6116 10.8477 13.6116 11.2813 13.3497 11.5432L11.0916 13.8013C10.9561 13.9368 10.7845 14 10.6129 14Z" fill="currentColor"></path><path d="M10.6129 14C10.2426 14 9.93552 13.6929 9.93552 13.3226V0.677419C9.93552 0.307097 10.2426 0 10.6129 0C10.9833 0 11.2904 0.307097 11.2904 0.677419V13.3226C11.2904 13.6929 10.9832 14 10.6129 14Z" fill="currentColor"></path></svg>`;

            const ascendingIcon = `<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon"><path d="M3.63435 0.19871C3.57113 0.135484 3.49887 0.0903226 3.41758 0.0541935C3.255 -0.0180645 3.06532 -0.0180645 2.90274 0.0541935C2.82145 0.0903226 2.74919 0.135484 2.68597 0.19871L0.427901 2.45677C0.165965 2.71871 0.165965 3.15226 0.427901 3.41419C0.689836 3.67613 1.12338 3.67613 1.38532 3.41419L2.48726 2.31226V13.3226C2.48726 13.6929 2.79435 14 3.16467 14C3.535 14 3.84209 13.6929 3.84209 13.3226V2.31226L4.94403 3.41419C5.07951 3.54968 5.25113 3.6129 5.42274 3.6129C5.59435 3.6129 5.76597 3.54968 5.90145 3.41419C6.16338 3.15226 6.16338 2.71871 5.90145 2.45677L3.64338 0.19871H3.63435ZM13.7685 13.3226C13.7685 12.9523 13.4615 12.6452 13.0911 12.6452H7.22016C6.84984 12.6452 6.54274 12.9523 6.54274 13.3226C6.54274 13.6929 6.84984 14 7.22016 14H13.0911C13.4615 14 13.7685 13.6929 13.7685 13.3226ZM7.22016 8.58064C6.84984 8.58064 6.54274 8.27355 6.54274 7.90323C6.54274 7.5329 6.84984 7.22581 7.22016 7.22581H9.47823C9.84855 7.22581 10.1556 7.5329 10.1556 7.90323C10.1556 8.27355 9.84855 8.58064 9.47823 8.58064H7.22016ZM7.22016 5.87097H7.67177C8.0421 5.87097 8.34919 5.56387 8.34919 5.19355C8.34919 4.82323 8.0421 4.51613 7.67177 4.51613H7.22016C6.84984 4.51613 6.54274 4.82323 6.54274 5.19355C6.54274 5.56387 6.84984 5.87097 7.22016 5.87097ZM11.2847 11.2903H7.22016C6.84984 11.2903 6.54274 10.9832 6.54274 10.6129C6.54274 10.2426 6.84984 9.93548 7.22016 9.93548H11.2847C11.655 9.93548 11.9621 10.2426 11.9621 10.6129C11.9621 10.9832 11.655 11.2903 11.2847 11.2903Z" fill="currentColor"></path></svg>`;

            const descendingIcon = `<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="p-icon p-sortable-column-icon" aria-hidden="true" data-pc-section="sorticon"><path d="M4.93953 10.5858L3.83759 11.6877V0.677419C3.83759 0.307097 3.53049 0 3.16017 0C2.78985 0 2.48275 0.307097 2.48275 0.677419V11.6877L1.38082 10.5858C1.11888 10.3239 0.685331 10.3239 0.423396 10.5858C0.16146 10.8477 0.16146 11.2813 0.423396 11.5432L2.68146 13.8013C2.74469 13.8645 2.81694 13.9097 2.89823 13.9458C2.97952 13.9819 3.06985 14 3.16017 14C3.25049 14 3.33178 13.9819 3.42211 13.9458C3.5034 13.9097 3.57565 13.8645 3.63888 13.8013L5.89694 11.5432C6.15888 11.2813 6.15888 10.8477 5.89694 10.5858C5.63501 10.3239 5.20146 10.3239 4.93953 10.5858ZM13.0957 0H7.22468C6.85436 0 6.54726 0.307097 6.54726 0.677419C6.54726 1.04774 6.85436 1.35484 7.22468 1.35484H13.0957C13.466 1.35484 13.7731 1.04774 13.7731 0.677419C13.7731 0.307097 13.466 0 13.0957 0ZM7.22468 5.41935H9.48275C9.85307 5.41935 10.1602 5.72645 10.1602 6.09677C10.1602 6.4671 9.85307 6.77419 9.48275 6.77419H7.22468C6.85436 6.77419 6.54726 6.4671 6.54726 6.09677C6.54726 5.72645 6.85436 5.41935 7.22468 5.41935ZM7.6763 8.12903H7.22468C6.85436 8.12903 6.54726 8.43613 6.54726 8.80645C6.54726 9.17677 6.85436 9.48387 7.22468 9.48387H7.6763C8.04662 9.48387 8.35372 9.17677 8.35372 8.80645C8.35372 8.43613 8.04662 8.12903 7.6763 8.12903ZM7.22468 2.70968H11.2892C11.6595 2.70968 11.9666 3.01677 11.9666 3.3871C11.9666 3.75742 11.6595 4.06452 11.2892 4.06452H7.22468C6.85436 4.06452 6.54726 3.75742 6.54726 3.3871C6.54726 3.01677 6.85436 2.70968 7.22468 2.70968Z" fill="currentColor"></path></svg>`;

            headers.forEach(header => {
                const column = header.getAttribute('data-column');
                const indicator = header.querySelector('.sort-indicator');

                if (column === currentSortColumn) {
                    if (currentSortDirection === 'asc') {
                        indicator.innerHTML = ascendingIcon;
                    } else if (currentSortDirection === 'desc') {
                        indicator.innerHTML = descendingIcon;
                    } else {
                        indicator.innerHTML = neutralIcon;
                    }
                } else {
                    indicator.innerHTML = neutralIcon; // Default to neutral if not sorted
                }
            });
        }

        // Fetch prices for all items and store them in an array
        async function getAllPrices() {
            const latestPricesApi = 'https://prices.runescape.wiki/api/v1/osrs/latest';
            const volumeApi = 'https://prices.runescape.wiki/api/v1/osrs/24h';
            try {
                const [latestResponse, volumeResponse] = await Promise.all([
                    fetch(latestPricesApi, {
                        method: 'GET',
                        headers: requestHeaders
                    }),
                    fetch(volumeApi, {
                        method: 'GET',
                        headers: requestHeaders
                    })
                ]);

                if (!latestResponse.ok || !volumeResponse.ok) {
                    throw new Error('Failed to fetch data from one or more APIs');
                }

                const latestData = await latestResponse.json();
                const volumeData = await volumeResponse.json();

                itemDataArray = []; // Clear previous data

                // Iterate through all items in the mapping
                for (const [itemName, itemId] of Object.entries(itemMapping)) {
                    const itemData = latestData.data[itemId];
                    const itemDetail = itemDetails.find(item => item.id === itemId); // Find item metadata
                    const volumeInfo = volumeData.data[itemId]; // Get volume data

                    if (itemData && itemDetail && volumeInfo) {
                        const imageUrl = `https://oldschool.runescape.wiki/images/${itemDetail.icon.replace(/\s+/g, '_')}`;

                        // Get human-readable time differences
                        const highTimeFormatted = getTimeDifference(itemData.highTime);
                        const lowTimeFormatted = getTimeDifference(itemData.lowTime);

                        // Add high and low volumes together
                        const totalVolume = volumeInfo.highPriceVolume + volumeInfo.lowPriceVolume;

                        // Calculate the tax (rounded down) and margin
                        const instabuyPrice = itemData.high;
                        const instasellPrice = itemData.low;

                        let taxValue = Math.floor(instabuyPrice * 0.01); // 1% tax rounded down

                        // Cap the tax value
                        if (taxValue > 5000000) {
                            taxValue = 5000000
                        }

                        const taxedInstabuy = instabuyPrice - taxValue; // Subtract rounded tax from instabuy price
                        const margin = taxedInstabuy - instasellPrice;
                        const potentialProfit = margin * itemDetail.limit;
                        const marginVolume = margin * totalVolume;
                        const highAlchValue = itemDetail.highalch;

                        // Store item data in the array
                        itemDataArray.push({
                            itemName,
                            itemId,
                            imageUrl,
                            instabuyPrice,
                            instasellPrice,
                            highTime: itemData.highTime, // For sorting by timestamp
                            lowTime: itemData.lowTime,   // For sorting by timestamp
                            highTimeFormatted,
                            lowTimeFormatted,
                            margin,
                            potentialProfit,
                            marginVolume,
                            totalVolume,
                            limit: itemDetail.limit,
                            highAlchValue,
                            taxValue
                        });
                    }
                }

                // Trigger filtering after data is fetched
                filterItems();
            } catch (error) {
                console.error('Error fetching all item data:', error);
                document.getElementById('item-list-body').innerHTML = `<tr><td colspan="12">Error fetching data. Please try again.</td></tr>`;
            }
        }

        // Fetch the item mapping and details when the page loads
        async function loadData() {
            await fetchItemNames();
            await fetchItemDetails();
            await getAllPrices();
            updateSortIndicators();

            // Refresh prices every 10 seconds
            setInterval(getAllPrices, 10000); // 10000 ms = 10 seconds
        }

        // Attach event listener to the search input
        document.getElementById('search-input').addEventListener('input', filterItems);

        // Attach event listeners to the table headers and icons
        const headers = document.querySelectorAll('th[data-column]');
        headers.forEach(header => {
            header.addEventListener('click', handleSort);
        });

        // Attach event listeners to the sort icons
        const sortIcons = document.querySelectorAll('.sort-indicator');
        sortIcons.forEach(icon => {
            icon.addEventListener('click', function (event) {
                const column = this.parentElement.getAttribute('data-column');
                if (!column) return;

                // Same sorting behavior as clicking the header
                if (currentSortColumn === column) {
                    currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSortColumn = column;
                    currentSortDirection = 'desc';
                }

                updateSortIndicators();
                filterItems();

                // Prevent click from propagating to the header
                event.stopPropagation();
            });
        });

        // Run loadData when the page is fully loaded
        window.onload = function () {
            loadData();
            setupNumberFormatting();
        };
    </script>
</body>

</html>